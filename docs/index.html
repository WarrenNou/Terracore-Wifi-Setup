
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Terracore Device Setup</title>
        
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
        
        <script
            src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
            crossorigin="anonymous"></script>

        <script src="main.js"></script>
        <link rel="stylesheet" type="text/css" href="main.css" />
        <link rel="icon" href="favicon.ico" type="image/x-icon">
    </head>

    <body>
        <div id="mainDiv" style="display:none">
            <div class="header">
                <h1>Terracore Setup</h1>
                <div class="step-indicator">
                    <div class="step active">
                        <div class="step-number">1</div>
                        <div class="step-label">Connect Device</div>
                    </div>
                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-label">Configure WiFi</div>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-label">Complete</div>
                    </div>
                </div>
            </div>
            
            <div class="welcome-section">
                <img src="terracore-logo.svg" alt="Terracore Logo" class="logo">
                <h2>Welcome to Terracore Device Setup</h2>
                <p class="subtitle">Let's get your device connected to your WiFi network</p>
            </div>

            <!-- Step 1: Connect Device -->
            <div id="connectDeviceDiv">
                <div class="instructions">
                    <h3>Connect Your Device</h3>
                    <div class="instruction-grid">
                        <div class="instruction-item">
                            <div class="instruction-icon">1</div>
                            <div class="instruction-text">Make sure your Terracore device is powered on</div>
                        </div>
                        <div class="instruction-item">
                            <div class="instruction-icon">2</div>
                            <div class="instruction-text">Connect the device to your computer using a USB cable</div>
                        </div>
                        <div class="instruction-item">
                            <div class="instruction-icon">3</div>
                            <div class="instruction-text">Allow your browser to access the USB device when prompted</div>
                        </div>
                    </div>
                    <div class="tip">
                        <span class="tip-icon">ðŸ’¡</span>
                        <span>If your device isn't detected, try unplugging and reconnecting it, then refresh this page.</span>
                    </div>
                </div>
                
                <div class="button-container">
                    <button id="selectDevice" class="primary-button">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 16V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 8H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Select Device
                    </button>
                </div>
            </div>
            
            <div id="statusContainer">
                <div id="statusDiv" class="status-message"></div>
                <div id="errorDiv" style="display:none"></div>
                <div class="loader" id="statusLoader" style="display:none">
                    <div class="spinner"></div>
                </div>
            </div>

            <!-- Step 2: Configure WiFi -->
            <div id="selectNetworkDiv" style="display:none">
                <div class="instructions">
                    <h3>Setup WiFi Connection</h3>
                    <div class="instruction-grid">
                        <div class="instruction-item">
                            <div class="instruction-icon">1</div>
                            <div class="instruction-text">Select your WiFi network from the list below</div>
                        </div>
                        <div class="instruction-item">
                            <div class="instruction-icon">2</div>
                            <div class="instruction-text">Enter your network password</div>
                        </div>
                        <div class="instruction-item">
                            <div class="instruction-icon">3</div>
                            <div class="instruction-text">Click "Configure" to complete setup</div>
                        </div>
                    </div>
                    <div class="tip">
                        <span class="tip-icon">ðŸ’¡</span>
                        <span>If your network isn't listed, click "Refresh Networks" to scan again.</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="ssidSelect">WiFi Network:</label>
                    <select id="ssidSelect"></select>
                    <button id="refreshNetworks" class="secondary-button">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1 4V10H7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M23 20V14H17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M20.49 9C19.9828 7.56678 19.1209 6.2854 17.9845 5.27542C16.8482 4.26543 15.4745 3.55976 13.9917 3.22426C12.5089 2.88875 10.9652 2.93436 9.50481 3.35677C8.04437 3.77918 6.71475 4.56479 5.64 5.64L1 10M23 14L18.36 18.36C17.2853 19.4352 15.9556 20.2208 14.4952 20.6432C13.0348 21.0656 11.4911 21.1112 10.0083 20.7757C8.52547 20.4402 7.1518 19.7346 6.01547 18.7246C4.87913 17.7146 4.01717 16.4332 3.51 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Refresh Networks
                    </button>
                </div>
                
                <div class="form-group">
                    <label for="passwordInput">Network Password:</label>
                    <div class="password-input-container">
                        <input id="passwordInput" type="password" placeholder="Enter password" />
                        <button id="togglePassword" class="toggle-password" type="button">
                            <svg class="eye-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M1 12C1 12 5 4 12 4C19 4 23 12 23 12C23 12 19 20 12 20C5 20 1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="button-container">
                    <button id="configureButton" class="primary-button">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M19.4 15C19.1277 15.6171 19.0717 16.2985 19.2401 16.9499C19.4085 17.6012 19.7933 18.1883 20.34 18.62L20.4 18.68C20.8444 19.1218 21.1373 19.6797 21.2435 20.2856C21.3498 20.8915 21.2643 21.5161 20.9979 22.0786C20.7315 22.6411 20.2983 23.1119 19.7593 23.4338C19.2204 23.7557 18.5979 23.9129 17.97 23.88C17.3716 23.9043 16.7799 23.7534 16.2756 23.4478C15.7713 23.1422 15.377 22.6953 15.14 22.17L15.08 22.07C14.7563 21.5278 14.2695 21.1135 13.6957 20.8883C13.1219 20.6632 12.4921 20.6418 11.9053 20.8282C11.3184 21.0146 10.8061 21.3972 10.4477 21.9156C10.0894 22.4341 9.90327 23.0573 9.92002 23.69C9.89627 24.3129 9.67127 24.9125 9.27778 25.4017C8.8843 25.8909 8.34402 26.2452 7.73609 26.4142C7.12815 26.5831 6.48441 26.5585 5.89239 26.3436C5.30037 26.1288 4.79069 25.7341 4.44002 25.21C4.12242 24.7216 3.97251 24.1481 4.01502 23.5719C4.05752 22.9958 4.2903 22.4501 4.68002 22.02L4.74002 21.96C5.28669 21.5283 5.67142 20.9412 5.83984 20.2899C6.00827 19.6385 5.95227 18.9571 5.68002 18.34C5.41558 17.746 4.98379 17.2478 4.44002 16.91C3.92558 16.5465 3.31937 16.3539 2.70002 16.36C2.07438 16.3663 1.46374 16.1772 0.953199 15.8209C0.442657 15.4647 0.0465819 14.9597 -0.179525 14.3738C-0.405632 13.7878 -0.448697 13.1511 -0.302571 12.5395C-0.156446 11.928 0.172142 11.3731 0.640018 10.95C1.10467 10.5268 1.68081 10.2493 2.30003 10.1541C2.91925 10.059 3.54812 10.15 4.12002 10.42C4.72333 10.6889 5.4047 10.7466 6.04608 10.5825C6.68747 10.4183 7.24576 10.043 7.62002 9.52L7.68002 9.41C8.00373 8.91316 8.1681 8.32465 8.14525 7.72957C8.12241 7.13449 7.91366 6.55965 7.55003 6.08C7.18639 5.60036 6.68601 5.23908 6.11753 5.04455C5.54904 4.85002 4.93824 4.83111 4.36002 4.99C3.76727 5.14716 3.13451 5.09337 2.57304 4.83933C2.01157 4.58529 1.55909 4.14645 1.29002 3.6C1.01946 3.0553 0.935319 2.43361 1.05254 1.83307C1.16976 1.23253 1.47987 0.689451 1.93331 0.281325C2.38675 -0.126801 2.96136 -0.37591 3.57125 -0.42907C4.18115 -0.48223 4.79159 -0.336569 5.31002 0.0100002C5.76866 0.319249 6.32559 0.448905 6.87928 0.374219C7.43297 0.299534 7.94807 0.0249457 8.33002 -0.4C8.70276 -0.819473 8.94141 -1.33379 9.00832 -1.88245C9.07524 -2.43112 8.96729 -2.98334 8.70002 -3.46C8.43276 -3.93666 8.02527 -4.30867 7.53444 -4.52655C7.0436 -4.74443 6.49721 -4.79299 5.98002 -4.66C5.38728 -4.50284 4.75452 -4.54898 4.19305 -4.80302C3.63157 -5.05706 3.1791 -5.4959 2.91002 -6.04C2.63946 -6.5847 2.55532 -7.2064 2.67254 -7.80693C2.78976 -8.40747 3.09987 -8.95055 3.55331 -9.35868C4.00675 -9.7668 4.58137 -10.0159 5.19126 -10.0691C5.80115 -10.1222 6.4116 -9.97657 6.93002 -9.63C7.38866 -9.32075 7.94559 -9.1911 8.49928 -9.26578C9.05297 -9.34047 9.56807 -9.61506 9.95002 -10.04" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Configure Device
                    </button>
                </div>
            </div>
            
            <!-- Step 3: Success -->
            <div id="successDiv" style="display:none">
                <div class="success-animation">
                    <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                        <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                        <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                    </svg>
                </div>
                
                <div class="success">
                    <h3>Connection Successful!</h3>
                    <p>Your Terracore device is now connected to WiFi.</p>
                </div>
                
                <div class="instructions">
                    <h3>Setup Complete</h3>
                    <p>Your Terracore device has been successfully configured and is ready to use.</p>
                    <p class="redirect-text">You will be redirected to the Terracore dashboard in <span id="countdown">5</span> seconds...</p>
                </div>
                
                <div class="button-container">
                    <button id="goToDashboard" class="primary-button">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 5L19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Go to Dashboard Now
                    </button>
                </div>
            </div>
        </div> <!-- #mainDiv -->

        <div id="unsupportedBrowserDiv" class="unsupported-browser" style="display:none">
            <div class="error-icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M15 9L9 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M9 9L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <h2>Browser Not Supported</h2>
            <p>Web-based device setup is not supported in this browser.</p>
            <p>Please use Chrome, Edge, or Opera to continue.</p>
            <p class="note">Note: This tool cannot be used on iOS in any browser.</p>
        </div>

        <div id="scripts">
            <script src='particle-usb.bundle.js'></script>
            <script>
                // Add this script for the redirect functionality
                function showSuccessAndRedirect() {
                    // Hide network selection div
                    $("#selectNetworkDiv").hide();
                    
                    // Update step indicators
                    $(".step").removeClass("active");
                    $(".step:nth-child(1)").addClass("completed");
                    $(".step:nth-child(2)").addClass("completed");
                    $(".step:nth-child(3)").addClass("active completed");
                    
                    // Hide the status/loader indicators
                    $("#statusContainer").hide();
                    
                    // Show success message with animation
                    $("#successDiv").show();
                    
                    // Start countdown
                    let count = 5;
                    const countdown = setInterval(function() {
                        count--;
                        $("#countdown").text(count);
                        if (count <= 0) {
                            clearInterval(countdown);
                            window.location.href = "https://terracore-website.onrender.com/";
                        }
                    }, 1000);
                    
                    // Direct button
                    $("#goToDashboard").click(function() {
                        clearInterval(countdown);
                        window.location.href = "https://terracore-website.onrender.com/";
                    });
                }
                
                // Toggle password visibility
                $("#togglePassword").click(function() {
                    const passwordInput = $("#passwordInput");
                    const eyeIcon = $(this).find(".eye-icon");
                    
                    if (passwordInput.attr("type") === "password") {
                        passwordInput.attr("type", "text");
                        eyeIcon.html('<path d="M1 12C1 12 5 4 12 4C19 4 23 12 23 12C23 12 19 20 12 20C5 20 1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>');
                    } else {
                        passwordInput.attr("type", "password");
                        eyeIcon.html('<path d="M17.94 17.94C16.2306 19.243 14.1491 19.9649 12 20C5 20 1 12 1 12C2.24389 9.68192 3.96914 7.65663 6.06 6.06M9.9 4.24C10.5883 4.0789 11.2931 3.99836 12 4C19 4 23 12 23 12C22.393 13.1356 21.6691 14.2048 20.84 15.19M14.12 14.12C13.8454 14.4148 13.5141 14.6512 13.1462 14.8151C12.7782 14.9791 12.3809 15.0673 11.9781 15.0744C11.5753 15.0815 11.1752 15.0074 10.8016 14.8565C10.4281 14.7056 10.0887 14.4811 9.80385 14.1962C9.51897 13.9113 9.29439 13.572 9.14351 13.1984C8.99262 12.8249 8.91853 12.4247 8.92563 12.0219C8.93274 11.6191 9.02089 11.2219 9.18488 10.8539C9.34887 10.4859 9.58525 10.1547 9.88 9.88" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M1 1L23 23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>');
                    }
                });
                
                // Refresh networks button
                $("#refreshNetworks").click(function() {
                    $("#selectDevice").trigger("click");
                });
                
                // Update step indicators when moving to WiFi config
                function updateToWifiConfigStep() {
                    $(".step").removeClass("active");
                    $(".step:nth-child(1)").addClass("completed");
                    $(".step:nth-child(2)").addClass("active");
                }
            </script>
        </div>
    </body>
</html>